"use strict";const e=require("../common/vendor.js"),r={data(){return{inputType:[{text:"车牌号码",value:"",type:"text"},{text:"现公里数",value:"",type:"number"},{text:"保养公里",value:"",type:"number"}],fileList:[],text:"最多上传4张图片，默认第一张为封面图。定时通知功能请在车辆详情页中设置哦~"}},methods:{deletePic(s){this.fileList.splice(s.index,1)},async afterRead(s){let t=[].concat(s.file),n=this.fileList.length;t.map(o=>{this.fileList.push({...o,status:"uploading",message:"上传中"})});for(let o=0;o<t.length;o++){let i=this.fileList[n];this.fileList.splice(n,1,Object.assign(i,{status:"success",message:"",url:""})),n++}},submit(){if(!this.fileList.length){e.index.showToast({icon:"error",title:"请至少选一张图",duration:2e3});return}let s=!1;for(let t=0;t<this.inputType.length;t++)if(!this.inputType[t].value){e.index.showToast({icon:"error",title:`请填写${this.inputType[t].text}`,duration:2e3}),s=!0;break}s||(e.index.showLoading({title:"正在新增~",mask:!0}),Promise.all(this.fileList.map(t=>this.uploadFilePromise(t.thumb))).then(t=>{this.addData(t)}).catch(t=>{e.index.hideLoading(),e.index.showModal({content:t.message||"新增失败",showCancel:!1})}))},uploadFilePromise(s){return new Promise((t,n)=>{e.Ls.uploadFile({filePath:s,cloudPath:Date.now()+".png",success(o){t(o.fileID)},fail(o){n(o)}})})},addData(s){e.Ls.database().collection("carInfo").add({license:this.inputType[0].value,km:this.inputType[1].value,maintenance_km:this.inputType[2].value,toastTime:"",imgUrls:s,createTime:e.dayjs().format("YYYY-MM-DD HH:MM")}).then(n=>{e.index.showToast({title:"新增成功",duration:1500}),this.clearInfo()}).catch(n=>{e.index.showModal({content:n.message||"新增失败",showCancel:!1})}).finally(()=>{e.index.hideLoading()})},clearInfo(){this.fileList.length=0;for(let s=0;s<this.inputType.length;s++)this.inputType[s].value=""}}};if(!Array){const s=e.resolveComponent("u-notice-bar"),t=e.resolveComponent("u-upload"),n=e.resolveComponent("u-line"),o=e.resolveComponent("u--input"),i=e.resolveComponent("u-button");(s+t+n+o+i)()}const p=()=>"../node-modules/uview-plus/components/u-notice-bar/u-notice-bar.js",d=()=>"../node-modules/uview-plus/components/u-upload/u-upload.js",m=()=>"../node-modules/uview-plus/components/u-line/u-line.js",h=()=>"../node-modules/uview-plus/components/u--input/u--input.js",_=()=>"../node-modules/uview-plus/components/u-button/u-button.js";Math||(p+d+m+h+_)();function f(s,t,n,o,i,a){return{a:e.p({text:i.text}),b:e.o(a.afterRead),c:e.o(a.deletePic),d:e.p({fileList:i.fileList,multiple:!0,maxCount:4,previewFullImage:!0}),e:e.f(i.inputType,(u,x,l)=>({a:e.t(u.text),b:"fe24963f-3-"+l,c:e.o(c=>u.value=c,u.text),d:e.p({placeholder:`请输入${u.text}`,type:u.type,border:"surround",modelValue:u.value}),e:u.text})),f:e.o(a.clearInfo),g:e.p({type:"warning",text:"一键清空",shape:"circle"}),h:e.o(a.submit),i:e.p({type:"success",text:"确定新增",shape:"circle"})}}const y=e._export_sfc(r,[["render",f],["__scopeId","data-v-fe24963f"],["__file","D:/object2/carManagement/component/imgUpload.vue"]]);wx.createComponent(y);
