"use strict";const t=require("../../../../common/vendor.js"),c={name:"u-upload",mixins:[t.mpMixin,t.mixin,t.mixinUp,t.props$11],data(){return{lists:[],isInCount:!0}},watch:{fileList:{immediate:!0,handler(){this.formatFileList()},immediate:!0,deep:!0}},emits:["error","beforeRead","oversize","afterRead","delete","clickPreview"],methods:{formatFileList(){const{fileList:e=[],maxCount:a}=this,o=e.map(i=>Object.assign(Object.assign({},i),{isImage:this.accept==="image"||t.index.$u.test.image(i.url||i.thumb),isVideo:this.accept==="video"||t.index.$u.test.video(i.url||i.thumb),deletable:typeof i.deletable=="boolean"?i.deletable:this.deletable}));this.lists=o,this.isInCount=o.length<a},chooseFile(){const{maxCount:e,multiple:a,lists:o,disabled:i}=this;if(i)return;let l;try{l=t.index.$u.test.array(this.capture)?this.capture:this.capture.split(",")}catch{l=[]}t.chooseFile(Object.assign({accept:this.accept,multiple:this.multiple,capture:l,compressed:this.compressed,maxDuration:this.maxDuration,sizeType:this.sizeType,camera:this.camera},{maxCount:e-o.length})).then(n=>{this.onBeforeRead(a?n:n[0])}).catch(n=>{this.$emit("error",n)})},onBeforeRead(e){const{beforeRead:a,useBeforeRead:o}=this;let i=!0;t.index.$u.test.func(a)&&(i=a(e,this.getDetail())),o&&(i=new Promise((l,n)=>{this.$emit("beforeRead",Object.assign(Object.assign({file:e},this.getDetail()),{callback:s=>{s?l():n()}}))})),i&&(t.index.$u.test.promise(i)?i.then(l=>this.onAfterRead(l||e)):this.onAfterRead(e))},getDetail(e){return{name:this.name,index:e??this.fileList.length}},onAfterRead(e){const{maxSize:a,afterRead:o}=this;if(Array.isArray(e)?e.some(l=>l.size>a):e.size>a){this.$emit("oversize",Object.assign({file:e},this.getDetail()));return}typeof o=="function"&&o(e,this.getDetail()),this.$emit("afterRead",Object.assign({file:e},this.getDetail()))},deleteItem(e){this.$emit("delete",Object.assign(Object.assign({},this.getDetail(e)),{file:this.fileList[e]}))},onPreviewImage(e){!e.isImage||!this.previewFullImage||t.index.previewImage({urls:this.lists.filter(a=>this.accept==="image"||t.index.$u.test.image(a.url||a.thumb)).map(a=>a.url||a.thumb),current:e.url||e.thumb,fail(){t.index.$u.toast("预览图片失败")}})},onPreviewVideo(e){if(!this.data.previewFullImage)return;const{index:a}=e.currentTarget.dataset,{lists:o}=this.data;t.wx$1.previewMedia({sources:o.filter(i=>isVideoFile(i)).map(i=>Object.assign(Object.assign({},i),{type:"video"})),current:a,fail(){t.index.$u.toast("预览视频失败")}})},onClickPreview(e){const{index:a}=e.currentTarget.dataset,o=this.data.lists[a];this.$emit("clickPreview",Object.assign(Object.assign({},o),this.getDetail(a)))}}};if(!Array){const e=t.resolveComponent("u-icon"),a=t.resolveComponent("u-loading-icon");(e+a)()}const h=()=>"../u-icon/u-icon.js",f=()=>"../u-loading-icon/u-loading-icon.js";Math||(h+f)();function p(e,a,o,i,l,n){return t.e({a:e.previewImage},e.previewImage?{b:t.f(l.lists,(s,u,r)=>t.e({a:s.isImage||s.type&&s.type==="image"},s.isImage||s.type&&s.type==="image"?{b:s.thumb||s.url,c:e.imageMode,d:t.o(d=>n.onPreviewImage(s),u),e:t.s({width:e.$u.addUnit(e.width),height:e.$u.addUnit(e.height)})}:{f:"cafe0b2a-0-"+r,g:t.p({color:"#80CBF9",size:"26",name:s.isVideo||s.type&&s.type==="video"?"movie":"folder"}),h:t.t(s.isVideo||s.type&&s.type==="video"?"视频":"文件")},{i:s.status==="uploading"||s.status==="failed"},s.status==="uploading"||s.status==="failed"?t.e({j:s.status==="failed"},s.status==="failed"?{k:"cafe0b2a-1-"+r,l:t.p({name:"close-circle",color:"#ffffff",size:"25"})}:{m:"cafe0b2a-2-"+r,n:t.p({size:"22",mode:"circle",color:"#ffffff"})},{o:s.message},s.message?{p:t.t(s.message)}:{}):{},{q:s.status!=="uploading"&&(e.deletable||s.deletable)},s.status!=="uploading"&&(e.deletable||s.deletable)?{r:"cafe0b2a-3-"+r,s:t.p({name:"close",color:"#ffffff",size:"10"}),t:t.o(d=>n.deleteItem(u),u)}:{},{v:s.status==="success"},s.status==="success"?{w:"cafe0b2a-4-"+r,x:t.p({name:"checkmark",color:"#ffffff",size:"12"})}:{},{y:u}))}:{},{c:l.isInCount},l.isInCount?t.e({d:e.$slots.default||e.$slots.$default},e.$slots.default||e.$slots.$default?{e:t.o((...s)=>n.chooseFile&&n.chooseFile(...s))}:t.e({f:t.p({name:e.uploadIcon,size:"26",color:e.uploadIconColor}),g:e.uploadText},e.uploadText?{h:t.t(e.uploadText)}:{},{i:e.disabled?"":"u-upload__button--hover",j:t.o((...s)=>n.chooseFile&&n.chooseFile(...s)),k:t.n(e.disabled&&"u-upload__button--disabled"),l:t.s({width:e.$u.addUnit(e.width),height:e.$u.addUnit(e.height)})})):{},{m:t.s(e.$u.addStyle(e.customStyle))})}const g=t._export_sfc(c,[["render",p],["__scopeId","data-v-cafe0b2a"],["__file","D:/object2/carManagement/node_modules/uview-plus/components/u-upload/u-upload.vue"]]);wx.createComponent(g);
